## 概览

通过前面的学习，我们了解到Kafka依赖ZooKeeper，所以需要先部署ZooKeeper集群。

### 环境准备

主机名 | IP 
-------|----
aming01|192.168.222.128
aming02|192.168.222.129
aming03|192.168.222.130

设置主机名，并设置hosts

关闭Selinux、firewalld并安装JDK

### 安装部署ZooKeeper

说明：以下操作在aming01上操作

* 下载ZooKeeper安装包

	wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/zookeeper-3.4.13.tar.gz

* 解压并挪到/usr/local/下

	tar zxf zookeeper-3.4.13.tar.gz
	
	mv zookeeper-3.4.13 /usr/local/zookeeper

* 创建数据、日志存放目录及当前节点ID

	cd /usr/local/zookeeper

	mkdir data 
	
	mkdir dataLog

	echo "1" > data/myid 

* 配置

	cp conf/zoo_sample.cfg conf/kafka_zk.cfg

	vi conf/kafka_zk.cfg  ##更改为如下配置

```
tickTime=2000
# 数据文件存放位置
dataDir=/usr/local/zookeeper/data
dataLogDir=/usr/local/zookeeper/dataLog
#服务监听端口
clientPort=2181
#选举等待时间
initLimit=5
syncLimit=2
#集群节点信息
server.1=aming01:2888:3888
server.2=aming02:2888:3888
server.3=aming03:2888:3888
```	

* 分发文件

	scp -r /usr/local/zookeeper  aming02:/usr/local/

	scp -r /usr/local/zookeeper  aming02:/usr/local/

* 修改id

	在aming02上，修改/usr/local/zookeeper/data/myid内容为2，aming03上修改为3

* 添加同步时间的任务计划啊（三台机器都执行）

	yum install -y ntpdate
	
	echo "*/5 * * * * ntpdate time.window.com" >> /var/spool/cron/root

* 启动集群（三台都执行）

	/usr/local/zookeeper/bin/zkServer.sh start /usr/local/zookeeper/conf/kafka_zk.cfg 

	/usr/local/zookeeper/bin/zkServer.sh status /usr/local/zookeeper/conf/kafka_zk.cfg  #查看集群状态
	
	/usr/local/zookeeper/bin/zkServer.sh stop /usr/local/zookeeper/conf/kafka_zk.cfg  #关闭集群
	
